name: Validate JSON File

on:
  pull_request:
    branches: [main]
    paths:
      - "contributors/*.json"

  workflow_dispatch:

concurrency:
    group: ${{ github.ref }}-ci
    cancel-in-progress: true

jobs:
    initialize:
      runs-on: ubuntu-latest  # windows-latest || macos-latest
      name: Initializing
      permissions:
        pull-requests: read
      steps:

      - uses: actions/checkout@v4

      - name: Fetch PR information
        if: github.event_name == 'pull_request'
        run: |
            # echo "PR_AUTHOR=${{ github.event.pull_request.user.login }}" >> $GITHUB_ENV
            # echo "PR_AUTHOR_ID=${{ github.event.pull_request.user.id }}" >> $GITHUB_ENV
            LABELS=$(gh api --jq '[.labels[].name]' /repos/{owner}/{repo}/pulls/${{ github.event.number }})
            echo "PR_LABELS=$LABELS" >> $GITHUB_ENV
            FILES=$(gh api --jq '[.[] | select(.status != "removed") | .filename]' /repos/{owner}/{repo}/pulls/${{ github.event.number }}/files)
            echo "CHANGED_FILES=$FILES" >> $GITHUB_ENV
            echo "CHANGED_FILES=$FILES"
            REMOVED_FILE_DATA=$(gh api --jq '[.[] | select(.status == "removed") | {name: .filename, data: .patch}]' /repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/files)
            echo "DELETED_FILES=$REMOVED_FILE_DATA" >> $GITHUB_ENV
        env:
            GH_TOKEN: ${{ github.token }}
      - name: Get changed files and write the outputs to a JSON file
        id: changed-files-write-output-files-json
        uses: tj-actions/changed-files@823fcebdb31bb35fdf2229d9f769b400309430d0 # v46
        with:
              json: true
              write_output_files: true

      - name: Verify the contents of the .github/outputs/added_files.json file
        run: |
              cat .github/outputs/added_files.json

    test:
      needs: initialize
      runs-on: ubuntu-latest  # windows-latest || macos-latest
      name: testing
      steps:
      # - uses: actions/checkout@v4
      - name: validation
        run: echo ${{github.job.initialize.env.CHANGED_FILES}}